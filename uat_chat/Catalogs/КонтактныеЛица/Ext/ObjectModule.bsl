Процедура ПриЗаписи(Отказ)
	Если ОбменДанными.Загрузка Тогда 
		Возврат;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ДатаРождения) И НапоминатьОДнеРождения Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		|	уатНапоминания.Пользователь
		|ИЗ
		|	РегистрСведений.уатНапоминания КАК уатНапоминания
		|ГДЕ
		|	уатНапоминания.Пользователь = &Пользователь
		|	И уатНапоминания.Завершено <> ИСТИНА
		|	И уатНапоминания.Объект = &Объект
		|	И уатНапоминания.Автор = &Пользователь
		|	И уатНапоминания.Тема = &Тема";

		Запрос.УстановитьПараметр("Пользователь", ПараметрыСеанса.ТекущийПользователь);
		Запрос.УстановитьПараметр("Объект", Ссылка);
		Запрос.УстановитьПараметр("Тема", "День рождения");
		
		Если Запрос.Выполнить().Пустой() Тогда
		
			МенЗаписи = РегистрыСведений.уатНапоминания.СоздатьМенеджерЗаписи();
			МенЗаписи.Пользователь = ПараметрыСеанса.ТекущийПользователь;				
			МенЗаписи.ДатаНачала = Дата(Формат(Год(ТекущаяДата()), "ЧГ=0") + Сред(Строка(ДатаРождения), 4, 2) + Лев(Строка(ДатаРождения), 2));
			МенЗаписи.РеальнаяДатаОповещения = Макс(ТекущаяДата(), МенЗаписи.ДатаНачала - КоличествоДнейДоНапоминания * 60 * 60 * 24);
			МенЗаписи.Объект = Ссылка;	
			МенЗаписи.Автор = ПараметрыСеанса.ТекущийПользователь;
			МенЗаписи.Тема = "День рождения";
			МенЗаписи.Описание = "Поздравить с днем рождения";
			Если ЗначениеЗаполнено(Должность) Тогда
				МенЗаписи.Описание = МенЗаписи.Описание +  Символы.ПС + "Должность: " + Должность + Символы.ПС;
			КонецЕсли; 
			МенЗаписи.Описание = МенЗаписи.Описание + "Дата рождения: " + Формат(ДатаРождения, "ДФ=dd.MM.yyyy") + Символы.ПС
  	  						   + "Исполняется лет: " + СокрЛП(Строка(Число(Формат(ТекущаяДата(),"ДФ=yyyy")) - Число(Формат(ДатаРождения,"ДФ=yyyy"))));
			МенЗаписи.ТипПериода = "8               1"; 
			МенЗаписи.УдалитьПоИстеченииСрока = Истина;
			
			МенЗаписи.Записать();
			
		КонецЕсли;		
	КонецЕсли;
КонецПроцедуры
